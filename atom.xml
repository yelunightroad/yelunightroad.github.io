<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>夜路漫漫</title>
  
  <subtitle>水深流缓，人贵语迟</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-11-29T10:08:44.001Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>邸宇飞</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo设置持续集成过程中遇到的一些问题</title>
    <link href="http://yoursite.com/2017/11/26/hexo%E8%AE%BE%E7%BD%AE%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2017/11/26/hexo设置持续集成过程中遇到的一些问题/</id>
    <published>2017-11-26T19:42:55.000Z</published>
    <updated>2017-11-29T10:08:44.001Z</updated>
    
    <content type="html"><![CDATA[<p>由于hexo d的方式来布置hexo博客不能满足多台计算机编辑以及备份的需求，所以参考<a href="https://formulahendry.github.io/2016/12/04/hexo-ci/" target="_blank" rel="noopener">Hexo的版本控制与持续集成</a>的博客，进行了持续集成的配置，效果显著， 终于可以随时随地的编辑博客了。</p><p>但是这个过程中也遇到一个问题，就是当我们使用第三方主题的时候（我使用的是next）主题文件夹不能上传到source repository，原因也很简单，因为我是直接使用<code>git clone https://github.com/iissnan/hexo-theme-next themes/next</code>克隆的next主题，所以next文件夹下有.git，是一个独立的repo，当然无法上传，删掉.git后就一切正常了，但这也带来另一个问题，就是我们想更新主题的时候比较麻烦，因为已经是一个独立的本地文件夹了，后来经过搜索，确定了使用git subtree来解决这个问题。</p><p>关于git subtree的内容大家可以自行网上搜索，简单来说就是git用来管理子项目的一种方式，整个操作过程如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 添加next仓库，命名为next</span><br><span class="line">git remote add next https://github.com/iissnan/hexo-theme-next</span><br><span class="line"><span class="meta">#</span>添加next的master分支到子树</span><br><span class="line">git subtree add --prefix=themes/next  next master --squash</span><br><span class="line"><span class="meta">#</span>看看有哪些稳定版本</span><br><span class="line">git ls-remote --tags next</span><br><span class="line"><span class="meta">#</span>测试切换到5.1.2版本</span><br><span class="line">git subtree pull --prefix=themes/next  next tags/v5.1.2 --squash</span><br><span class="line"><span class="meta">#</span>测试切换到5.1.3版本</span><br><span class="line">git subtree pull --prefix=themes/next  next tags/v5.1.3 --squash</span><br></pre></td></tr></table></figure><p>在切换到5.1.2版本后，我修改了主题配置文件，添加了livere_uid(來必力评论配置，在next主题下配置这一行就可以开启，简单易配置，不翻墙就可以评论，推荐大家使用)，然后尝试切换到5.1.3版本，发现很智能保留了这个配置（两个版本的配置文件是不同的，merge的过程很顺利），所以通过这个方案切换新版本应该是可行的。</p><p>这里需要注意的即使代码的第4行，我一开始写的是<code>git subtree add --prefix=themes/next  next tags/v5.1.2 --squash</code>，在这样的情况下5.1.2版本的下载倒是没有问题，但是更新到5.1.3时，会提示已经是最新的代码无法更新，相信大多数人还是以稳定版为主，如果不是想折腾一下源码的话，所以推荐按照现在的顺序来配置。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;由于hexo d的方式来布置hexo博客不能满足多台计算机编辑以及备份的需求，所以参考&lt;a href=&quot;https://formulahendry.github.io/2016/12/04/hexo-ci/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;H
      
    
    </summary>
    
      <category term="博客" scheme="http://yoursite.com/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="CI" scheme="http://yoursite.com/tags/CI/"/>
    
      <category term="git subtree" scheme="http://yoursite.com/tags/git-subtree/"/>
    
      <category term="來必力" scheme="http://yoursite.com/tags/%E4%BE%86%E5%BF%85%E5%8A%9B/"/>
    
  </entry>
  
  <entry>
    <title>yii1.1版本下访问数据库时需要注意的问题</title>
    <link href="http://yoursite.com/2017/11/26/yii1-1%E7%89%88%E6%9C%AC%E4%B8%8B%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2017/11/26/yii1-1版本下访问数据库时需要注意的问题/</id>
    <published>2017-11-26T19:42:55.000Z</published>
    <updated>2017-11-29T10:08:44.028Z</updated>
    
    <content type="html"><![CDATA[<p>上篇文章提到我们使用了greenplum来代替mysql来适应数据规模较大的情况，同时尽量保证小的改动。服务端我们使用的是yii1.1版本，之所以不是2.0原因很简单，历史选择。但在使用greenplum的过程中我们发现某些查询下速度特别慢，后经过各种测试发现，一旦调用了prepare方法，在数据量较大时速度就会特别慢，怀疑时greenplum优化的问题，但由于使用的是dba自己改造后的版本，也就没有深究其官方版本是不是也存在这样的bug。</p><p>那么现在的问题就变成了我们使用的是CDbcommand模块queryAll方法，并没有调用其prepare方法，那么为什么还会慢的，阅读其源码发现，所有的query方法，最终都是靠queryInternal方法实现的，在该函数的32行我们不难发现，默认情况先总会调用prepare函数，所以即使我们没有显示的调用CDbcommand的prepare方法，最终还是难以避免这一点。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">queryInternal</span><span class="params">($method,$mode,$params=array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$params=array_merge(<span class="keyword">$this</span>-&gt;params,$params);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;_connection-&gt;enableParamLogging &amp;&amp; ($pars=array_merge(<span class="keyword">$this</span>-&gt;_paramLog,$params))!==<span class="keyword">array</span>())</span><br><span class="line">&#123;</span><br><span class="line">$p=<span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span>($pars <span class="keyword">as</span> $name=&gt;$value)</span><br><span class="line">$p[$name]=$name.<span class="string">'='</span>.var_export($value,<span class="keyword">true</span>);</span><br><span class="line">$par=<span class="string">'. Bound with '</span>.implode(<span class="string">', '</span>,$p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">$par=<span class="string">''</span>;</span><br><span class="line">Yii::trace(<span class="string">'Querying SQL: '</span>.<span class="keyword">$this</span>-&gt;getText().$par,<span class="string">'system.db.CDbCommand'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;_connection-&gt;queryCachingCount&gt;<span class="number">0</span> &amp;&amp; $method!==<span class="string">''</span></span><br><span class="line">&amp;&amp; <span class="keyword">$this</span>-&gt;_connection-&gt;queryCachingDuration&gt;<span class="number">0</span></span><br><span class="line">&amp;&amp; <span class="keyword">$this</span>-&gt;_connection-&gt;queryCacheID!==<span class="keyword">false</span></span><br><span class="line">&amp;&amp; ($cache=Yii::app()-&gt;getComponent(<span class="keyword">$this</span>-&gt;_connection-&gt;queryCacheID))!==<span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;_connection-&gt;queryCachingCount--;</span><br><span class="line">$cacheKey=<span class="string">'yii:dbquery'</span>.<span class="string">':'</span>.$method.<span class="string">':'</span>.<span class="keyword">$this</span>-&gt;_connection-&gt;connectionString.<span class="string">':'</span>.<span class="keyword">$this</span>-&gt;_connection-&gt;username;</span><br><span class="line">$cacheKey.=<span class="string">':'</span>.<span class="keyword">$this</span>-&gt;getText().<span class="string">':'</span>.serialize(array_merge(<span class="keyword">$this</span>-&gt;_paramLog,$params));</span><br><span class="line"><span class="keyword">if</span>(($result=$cache-&gt;get($cacheKey))!==<span class="keyword">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">Yii::trace(<span class="string">'Query result found in cache'</span>,<span class="string">'system.db.CDbCommand'</span>);</span><br><span class="line"><span class="keyword">return</span> $result[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;_connection-&gt;enableProfiling)</span><br><span class="line">Yii::beginProfile(<span class="string">'system.db.CDbCommand.query('</span>.<span class="keyword">$this</span>-&gt;getText().$par.<span class="string">')'</span>,<span class="string">'system.db.CDbCommand.query'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;prepare();</span><br><span class="line"><span class="keyword">if</span>($params===<span class="keyword">array</span>())</span><br><span class="line"><span class="keyword">$this</span>-&gt;_statement-&gt;execute();</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;_statement-&gt;execute($params);</span><br><span class="line"><span class="keyword">if</span>($method===<span class="string">''</span>)</span><br><span class="line">$result=<span class="keyword">new</span> CDbDataReader(<span class="keyword">$this</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$mode=(<span class="keyword">array</span>)$mode;</span><br><span class="line">call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;_statement, <span class="string">'setFetchMode'</span>), $mode);</span><br><span class="line">$result=<span class="keyword">$this</span>-&gt;_statement-&gt;$method();</span><br><span class="line"><span class="keyword">$this</span>-&gt;_statement-&gt;closeCursor();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;_connection-&gt;enableProfiling)</span><br><span class="line">Yii::endProfile(<span class="string">'system.db.CDbCommand.query('</span>.<span class="keyword">$this</span>-&gt;getText().$par.<span class="string">')'</span>,<span class="string">'system.db.CDbCommand.query'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($cache,$cacheKey))</span><br><span class="line">$cache-&gt;set($cacheKey, <span class="keyword">array</span>($result), <span class="keyword">$this</span>-&gt;_connection-&gt;queryCachingDuration, <span class="keyword">$this</span>-&gt;_connection-&gt;queryCachingDependency);</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;_connection-&gt;enableProfiling)</span><br><span class="line">Yii::endProfile(<span class="string">'system.db.CDbCommand.query('</span>.<span class="keyword">$this</span>-&gt;getText().$par.<span class="string">')'</span>,<span class="string">'system.db.CDbCommand.query'</span>);</span><br><span class="line">$errorInfo=$e <span class="keyword">instanceof</span> PDOException ? $e-&gt;errorInfo : <span class="keyword">null</span>;</span><br><span class="line">$message=$e-&gt;getMessage();</span><br><span class="line">Yii::log(Yii::t(<span class="string">'yii'</span>,<span class="string">'CDbCommand::&#123;method&#125;() failed: &#123;error&#125;. The SQL statement executed was: &#123;sql&#125;.'</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">'&#123;method&#125;'</span>=&gt;$method, <span class="string">'&#123;error&#125;'</span>=&gt;$message, <span class="string">'&#123;sql&#125;'</span>=&gt;<span class="keyword">$this</span>-&gt;getText().$par)),CLogger::LEVEL_ERROR,<span class="string">'system.db.CDbCommand'</span>);</span><br><span class="line"><span class="keyword">if</span>(YII_DEBUG)</span><br><span class="line">$message.=<span class="string">'. The SQL statement executed was: '</span>.<span class="keyword">$this</span>-&gt;getText().$par;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> CDbException(Yii::t(<span class="string">'yii'</span>,<span class="string">'CDbCommand failed to execute the SQL statement: &#123;error&#125;'</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">'&#123;error&#125;'</span>=&gt;$message)),(int)$e-&gt;getCode(),$errorInfo);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终的解决方案是在配置中加了’emulatePrepare’ =&gt; true的配置，该配置项其实就是启用了pdo中的模拟预处理，用模拟预处理代替greenplum龟速的预处理，最终解决了该问题。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;上篇文章提到我们使用了greenplum来代替mysql来适应数据规模较大的情况，同时尽量保证小的改动。服务端我们使用的是yii1.1版本，之所以不是2.0原因很简单，历史选择。但在使用greenplum的过程中我们发现某些查询下速度特别慢，后经过各种测试发现，一旦调用了p
      
    
    </summary>
    
      <category term="web开发" scheme="http://yoursite.com/categories/web%E5%BC%80%E5%8F%91/"/>
    
      <category term="数据库访问" scheme="http://yoursite.com/categories/web%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE/"/>
    
    
      <category term="greenplum" scheme="http://yoursite.com/tags/greenplum/"/>
    
      <category term="yii" scheme="http://yoursite.com/tags/yii/"/>
    
      <category term="emulate prepare" scheme="http://yoursite.com/tags/emulate-prepare/"/>
    
  </entry>
  
  <entry>
    <title>mysql与postgresql的区别</title>
    <link href="http://yoursite.com/2017/11/14/mysql%E4%B8%8Epostgresql%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>http://yoursite.com/2017/11/14/mysql与postgresql的区别/</id>
    <published>2017-11-14T23:11:19.000Z</published>
    <updated>2017-11-29T10:08:44.001Z</updated>
    
    <content type="html"><![CDATA[<p>在工作中由于数据量太大时mysql负载的压力，我们引入了greenplum做我们大数据量表格的数据库，选择greenplum的原因是它在解决大数据存储的同时，尽可能的保持了和mysql一样的操作逻辑（同是关系型数据库，使用sql查询），减小了我们的迁移成本，但是尽管如此，greenplum基于的postgresql引擎和mysql还是存在一定的差异，此文对目前遇到的问题进行了记录，以防止以后再次出现同样的问题。</p><ol><li><p>反引号的区别</p><p>在mysql中，对于保留字使用反引号来加以区分，例如想查询一个表中的select字段，由于select是保留字我们需写成</p><p><code>SELECT `select` FROM table</code></p><p>而在postgresql中不存在这种写法，当identifier为保留字时，则使用双引号</p><p><code>SELECT &quot;select&quot; FROM table</code></p></li><li><p>limit的差别</p><p>在mysql中limit可以间简写为<code>limit 10,100</code>，其等价于<code>limit 100 offset 10</code>而在postgresql中只能采用第二种标准的sql方式</p></li><li><p>对if语句的支持</p><p>mysql支持if 语句，例如<code>if(x&gt;1,1,0)</code>而postgresql只支持case when语句</p></li><li><p>大小写</p><p>mysql中是不区分大小写的，你查询一个字段，写大小写都可以，而在postgresql中是区分大小写的，如果想要字段名大些，必须用双引号将其扩起，由于一些历史原因mysql中使用了大写的字段名，查询也没有问题，但是到postgresql中就失败了，所以建议在sql中，采用下划线分割，不要使用驼峰命名发</p></li></ol><p>以上就是目前遇到的mysql迁移greenplum过程中遇到的一些问题，可以看到大部分是因为mysql在标准sql的基础上给我们提供了更加方便的解决方式，但这种方式在迁移数据库时会给我们带来意想不到的麻烦，所以除非肯定只用一种数据库，否则还是建议按照标准sql书写</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在工作中由于数据量太大时mysql负载的压力，我们引入了greenplum做我们大数据量表格的数据库，选择greenplum的原因是它在解决大数据存储的同时，尽可能的保持了和mysql一样的操作逻辑（同是关系型数据库，使用sql查询），减小了我们的迁移成本，但是尽管如此，g
      
    
    </summary>
    
      <category term="sql相关" scheme="http://yoursite.com/categories/sql%E7%9B%B8%E5%85%B3/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
      <category term="postgresql" scheme="http://yoursite.com/tags/postgresql/"/>
    
      <category term="greenplum" scheme="http://yoursite.com/tags/greenplum/"/>
    
  </entry>
  
</feed>
